{% include "./pebbles/lightbox.confirm.html" %}
<script src="{{ assetsUrl }}/js/domready.js"></script>
<script type="text/javascript">
    (function() {
        console.log("calling in");
        debugger;
        var lightboxInit = function () {
            console.log("lightbox = " + typeof DomReady);

            if('undefined' === typeof DomReady) {
                console.log("timing out = " + typeof DomReady);

                setTimeout(lightboxInit, 60);
                return;
            }

            console.log("readying");
            DomReady.ready(function () {
                var content = document.getElementById("xly");
                if (content && content !== document.body.firstChild) {
                    document.body.insertBefore(content, document.body.firstChild);
                }

                var link = document.getElementById("xly-accept-link");
                console.log("link = " + link);
                if (link) {
                    console.log("in here");
                    link.addEventListener('click', function (event) {
                        console.log("click");
                        content.classList.add('xly-busy');
                        var url = "{{ migrationInitiateUrl }}";
                        var optout = document.getElementById("xly-subscribe-input");
                        if (optout && optout.checked) {
                            url += '?optout=true';
                        }
                        window.location.replace(url);
                    });
                }
            });
        };

        lightboxInit();
    })();
</script>